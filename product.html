<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Detail</title>
    <link rel="stylesheet" href="home.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-dark">
        <div class="collapse navbar-collapse" id="navbarScroll">
            <ul class="navbar-nav mr-auto my-2 my-lg-0 navbar-nav-scroll" style="max-height: 100px;">
                <a class="navbar-brand" href="home.html">
                    <img src="https://logo.com/image-cdn/images/kts928pd/production/46fec0239332173dd16844534aab6117435e8f46-731x731.png?w=1080&q=72"
                        width="50" height="50" alt="">
                </a>
            </ul>
            <form class="d-flex mr-5" style="gap: 20px;">
                <a href="category.html"><i class="fa fa-list-alt" aria-hidden="true"></i></a>
                <a href="form.html"><i class="fa fa-plus-square" aria-hidden="true"></i></a>
                <a href="AddToCart.html"><i class="fa fa-shopping-cart" aria-hidden="true"></i></a>
                <a href="checkout.html"><i class="fa fa-credit-card-alt" aria-hidden="true"></i></a>
            </form>
        </div>
    </nav>
    <div id="product-detail-container" style="margin-top: 100px; ">
        
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
<script>
      // Retrieve the product ID from the URL
        const queryParams = new URLSearchParams(window.location.search);
        const productId = Number(queryParams.get('id'));

        // Retrieve the products array from local storage
        const products = JSON.parse(localStorage.getItem("products")) || [];
        // Find the product with the matching ID from the products array
        const product = products.find(p => p.id === productId);
        const discountedPrice = Math.round(
                product.price * (1 - product.discount / 100)
            );

            // Display the product details on the page
            const productDetailContainer = document.getElementById('product-detail-container');
            if (product) {
                    let imagesHtml = '';
                    product.image.forEach((imageUrl, index) => {
                        imagesHtml += `
            <div class="carousel-item ${index === 0 ? 'active' : ''}">
                <img style="height: 600px; justify-content: center; display: grid; margin-left: 300px;" src="${imageUrl}" alt="${product.title}">
            </div>
        `;
                    });

                    productDetailContainer.innerHTML = `
        <div class="container">
            <div id="product-detail-container" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">
                    ${imagesHtml}
                </div>
            </div>
            <div class="product-details">
                <h2>${product.title}</h2>
                <del><p>Price: ₹ ${product.price}</p></del>
                <p>Discount: ₹ ${discountedPrice}</p>
                <p>Quantity: ${product.availableQuantity}</p>
                <a href="#" class="btn btn-primary addToCartBtn">Add To Cart</a>
            </div>
        </div>
    `;

                    const addToCartBtn = document.querySelector(".addToCartBtn");
                    addToCartBtn.addEventListener("click", () => {
                        addToCart(product, addToCartBtn, "Product added to cart", discountedPrice);
                    });
                } else {
                    productDetailContainer.innerHTML = '<p>Product not found</p>';
                }

                function addToCart(product, button, customMessage, discountedPrice) {
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];

                    const isProductInCart = cart.some((item) => item.id === product.id);

                    if (isProductInCart) {
                        alert("This product is already in your cart.");
                    } else {
                        const cartItem = {
                            ...product,
                            discountedPrice: discountedPrice,
                            quantity: 1,
                        };

                        cart.push(cartItem);
                        localStorage.setItem("cart", JSON.stringify(cart));
                        alert(customMessage || "Product added to cart");

                        button.disabled = true;
                    }
                }
</script>

</html>